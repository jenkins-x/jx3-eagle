apiVersion: gitops.jenkins-x.io/v1alpha1
kind: Scheduler
metadata:
  name: jxr-versions
spec:
  plugins:
    entries:
      - label
  postsubmits:
    entries:
      - agent: tekton
        branches:
          - master
        context: ""
        name: release
    replace: true
  presubmits:
    entries:
      - agent: tekton
        always_run: true
        context: gsm
        name: gsm
        queries:
          - labels:
              entries:
                - approved
                - lgtm
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
          - labels:
              entries:
                - updatebot
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
                - needs-security-review
        report: true
        rerun_command: /test gsm
        trigger: (?m)^/test( all| gsm),?(s+|$)
      - agent: tekton
        always_run: false
        context: ghe
        name: ghe
        queries:
          - labels:
              entries:
                - approved
                - lgtm
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
          - labels:
              entries:
                - updatebot
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
                - needs-security-review
        report: true
        rerun_command: /test ghe
        trigger: (?m)^/test( all| ghe),?(s+|$)
      - agent: tekton
        always_run: false
        context: istio
        name: istio
        queries:
          - labels:
              entries:
                - approved
                - lgtm
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
          - labels:
              entries:
                - updatebot
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
                - needs-security-review
        report: true
        rerun_command: /test istio
        trigger: (?m)^/test( all| istio| istio-all),?(s+|$)
      - agent: tekton
        always_run: false
        context: istio-tls
        name: istio-tls
        queries:
          - labels:
              entries:
                - approved
                - lgtm
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
          - labels:
              entries:
                - updatebot
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
                - needs-security-review
        report: true
        rerun_command: /test istio-tls
        trigger: (?m)^/test( all| istio-tls| istio-all),?(s+|$)
      - agent: tekton
        always_run: false
        context: kube
        name: kube
        queries:
          - labels:
              entries:
                - approved
                - lgtm
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
          - labels:
              entries:
                - updatebot
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
                - needs-security-review
        report: true
        rerun_command: /test kube
        trigger: (?m)^/test( all| kube),?(s+|$)
      - agent: tekton
        always_run: false
        context: mc
        name: mc
        queries:
          - labels:
              entries:
                - approved
                - lgtm
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
          - labels:
              entries:
                - updatebot
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
                - needs-security-review
        report: true
        rerun_command: /test mc
        trigger: (?m)^/test( all| mc),?(s+|$)
      - agent: tekton
        always_run: false
        context: remote
        name: remote
        queries:
          - labels:
              entries:
                - approved
                - lgtm
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
          - labels:
              entries:
                - updatebot
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
                - needs-security-review
        report: true
        rerun_command: /test mc
        trigger: (?m)^/test( all| mc),?(s+|$)
      - agent: tekton
        always_run: false
        context: storage
        name: storage
        queries:
          - labels:
              entries:
                - approved
                - lgtm
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
          - labels:
              entries:
                - updatebot
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
                - needs-security-review
        report: true
        rerun_command: /test storage
        trigger: (?m)^/test( all| storage),?(s+|$)
      - agent: tekton
        always_run: false
        context: terraform
        name: terraform
        queries:
          - labels:
              entries:
                - approved
                - lgtm
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
          - labels:
              entries:
                - updatebot
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
                - needs-security-review
        report: true
        rerun_command: /test terraform
        trigger: (?m)^/test( all| terraform),?(s+|$)
      - agent: tekton
        always_run: true
        context: tls
        name: tls
        queries:
          - labels:
              entries:
                - approved
                - lgtm
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
          - labels:
              entries:
                - updatebot
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
                - needs-security-review
        report: true
        rerun_command: /test tls
        trigger: (?m)^/test( all| tls),?(s+|$)
      - agent: tekton
        always_run: true
        context: vault
        name: vault
        queries:
          - labels:
              entries:
                - approved
                - lgtm
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
          - labels:
              entries:
                - updatebot
            missingLabels:
              entries:
                - do-not-merge
                - do-not-merge/hold
                - do-not-merge/work-in-progress
                - needs-ok-to-test
                - needs-rebase
                - needs-security-review
        report: true
        rerun_command: /test vault
        trigger: (?m)^/test( default| all| vault),?(s+|$)
    replace: true
